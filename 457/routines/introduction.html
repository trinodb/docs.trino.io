<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Alata&family=Open+Sans:ital,wght%400,300;0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="2196f3">
  <script src="../_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Introduction to SQL routines &#8212; Trino 457 Documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=bbebba6e" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/trino.css?v=daa3c281" />
    <script src="../_static/jquery.js?v=5d32c60e"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../_static/documentation_options.js?v=9358237b"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <link rel="canonical" href="https://trino.io/docs/current/routines/introduction.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example SQL routines" href="examples.html" />
    <link rel="prev" title="SQL routines" href="../routines.html" />
  
   

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-RJ94STKPJ5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-RJ94STKPJ5');
      gtag('config', 'UA-133457846-1');
      gtag('config', 'AW-1036784065');
      window._linkedin_data_partner_ids = ['2842796'];
    </script>
    <script async src="https://snap.licdn.com/li.lms-analytics/insight.min.js"></script>
  </head>
  <body dir=ltr
        data-md-color-primary= data-md-color-accent=>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#routines/introduction" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
    <nav class="md-header-nav md-grid">
        <div class="md-flex navheader">
            <div class="md-flex__cell md-flex__cell--shrink">
                <a href="/" title="Trino"
                   class="md-header-nav__button md-logo">
                    
                    <!-- https://github.com/bashtage/sphinx-material/issues/136 -->
                    <img src="../_static/trino.svg" height="26"
                         alt="Trino 457 Documentation logo">
                    
                </a>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
                <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch">
                <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
                    <span class="md-header-nav__topic">Trino 457 Documentation</span>
                    <span class="md-header-nav__topic"> Introduction to SQL routines </span>
                </div>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
                <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
                
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

            </div>
            
            <div class="md-flex__cell md-flex__cell--shrink">
                <div class="md-header-nav__source">
                    <a href="https://github.com/trinodb/trino" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Trino
  </div>
</a>
                </div>
            </div>
            
            
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../../versions.json",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

        </div>
    </nav>
</header>

  
  <div class="md-container">
    
    
    <!-- empty -->
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="__drawer">
        <a href="/" title="Trino" class="md-nav__button md-logo">
            
            <img src="../_static/trino.svg" alt=" logo" width="48" height="48">
            
        </a>
        <a href="../index.html"
           title="Trino 457 Documentation">Trino 457 Documentation</a>
    </label>
    <div class="md-nav__source">
        <a href="https://github.com/trinodb/trino" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Trino
  </div>
</a>
    </div>
    
    

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../client.html" class="md-nav__link">Clients</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../object-storage.html" class="md-nav__link">Object storage</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL statement syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../routines.html" class="md-nav__link">SQL routines</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Introduction </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Introduction</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
    <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#inline-routines" class="md-nav__link">Inline routines</a>
        </li>
        <li class="md-nav__item"><a href="#catalog-routines" class="md-nav__link">Catalog routines</a>
        </li>
        <li class="md-nav__item"><a href="#sql-environment-configuration" class="md-nav__link">SQL environment configuration</a>
        </li>
        <li class="md-nav__item"><a href="#routine-declaration" class="md-nav__link">Routine declaration</a>
        </li>
        <li class="md-nav__item"><a href="#labels" class="md-nav__link">Labels</a>
        </li>
        <li class="md-nav__item"><a href="#recommendations" class="md-nav__link">Recommendations</a>
        </li>
        <li class="md-nav__item"><a href="#limitations" class="md-nav__link">Limitations</a>
        </li>
    </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="examples.html" class="md-nav__link">Examples</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="begin.html" class="md-nav__link">BEGIN</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="case.html" class="md-nav__link">CASE</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="declare.html" class="md-nav__link">DECLARE</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="function.html" class="md-nav__link">FUNCTION</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="if.html" class="md-nav__link">IF</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="iterate.html" class="md-nav__link">ITERATE</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="leave.html" class="md-nav__link">LEAVE</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="loop.html" class="md-nav__link">LOOP</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="repeat.html" class="md-nav__link">REPEAT</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="return.html" class="md-nav__link">RETURN</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="set.html" class="md-nav__link">SET</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="while.html" class="md-nav__link">WHILE</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../glossary.html" class="md-nav__link">Glossary</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../appendix.html" class="md-nav__link">Appendix</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
    <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#inline-routines" class="md-nav__link">Inline routines</a>
        </li>
        <li class="md-nav__item"><a href="#catalog-routines" class="md-nav__link">Catalog routines</a>
        </li>
        <li class="md-nav__item"><a href="#sql-environment-configuration" class="md-nav__link">SQL environment configuration</a>
        </li>
        <li class="md-nav__item"><a href="#routine-declaration" class="md-nav__link">Routine declaration</a>
        </li>
        <li class="md-nav__item"><a href="#labels" class="md-nav__link">Labels</a>
        </li>
        <li class="md-nav__item"><a href="#recommendations" class="md-nav__link">Recommendations</a>
        </li>
        <li class="md-nav__item"><a href="#limitations" class="md-nav__link">Limitations</a>
        </li>
    </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="introduction-to-sql-routines">
<h1 id="routines-introduction--page-root">Introduction to SQL routines<a class="headerlink" href="#routines-introduction--page-root" title="Link to this heading">#</a></h1>
<p>A SQL routine is a custom, user-defined function authored by a user of Trino and
written in the SQL routine language. Routines are scalar functions that return a
single output value, similar to <a class="reference internal" href="../functions.html"><span class="doc std std-doc">built-in functions</span></a>.</p>
<p><a class="reference internal" href="#routine-declaration"><span class="std std-ref">Declare the routine</span></a> with a <code class="docutils literal notranslate"><span class="pre">FUNCTION</span></code> definition using
the supported SQL routine statements. A routine can be declared and used as an
<a class="reference internal" href="#routine-inline"><span class="std std-ref">inline routine</span></a> or declared as a <a class="reference internal" href="#routine-catalog"><span class="std std-ref">catalog
routine</span></a> and used repeatedly.</p>
<section id="inline-routines">
<span id="routine-inline"></span><h2 id="inline-routines">Inline routines<a class="headerlink" href="#inline-routines" title="Link to this heading">#</a></h2>
<p>An inline routine declares and uses the routine within a query processing
context. The routine is declared in a <code class="docutils literal notranslate"><span class="pre">WITH</span></code> block before the query:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="w">  </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">abc</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span>
<span class="w">    </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">abc</span><span class="p">(</span><span class="mi">21</span><span class="p">);</span>
</pre></div>
</div>
<p>Inline routine names must follow SQL identifier naming conventions, and cannot
contain <code class="docutils literal notranslate"><span class="pre">.</span></code> characters.</p>
<p>The routine declaration is only valid within the context of the query. A
separate later invocation of the routine is not possible. If this is desired,
use a <a class="reference internal" href="#routine-catalog"><span class="std std-ref">catalog routine</span></a>.</p>
<p>Multiple inline routine declarations are comma-separated, and can include
routines calling each other, as long as a called routine is declared before
the first invocation.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="w">  </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">abc</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span>
<span class="w">    </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">  </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">xyz</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span>
<span class="w">    </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">abc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">xyz</span><span class="p">(</span><span class="mi">21</span><span class="p">);</span>
</pre></div>
</div>
<p>Note that inline routines can mask and override the meaning of a built-in function:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">WITH</span>
<span class="w">  </span><span class="k">FUNCTION</span><span class="w"> </span><span class="k">abs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span>
<span class="w">    </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="w">    </span><span class="k">RETURN</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">abs</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="c1">-- -20, not 10!</span>
</pre></div>
</div>
</section>
<section id="catalog-routines">
<span id="routine-catalog"></span><h2 id="catalog-routines">Catalog routines<a class="headerlink" href="#catalog-routines" title="Link to this heading">#</a></h2>
<p>You can store a routine in the context of a catalog, if the connector used in
the catalog supports routine storage. The following connectors support catalog
routine storage:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../connector/hive.html"><span class="doc std std-doc">Hive connector</span></a></p></li>
<li><p><a class="reference internal" href="../connector/memory.html"><span class="doc std std-doc">Memory connector</span></a></p></li>
</ul>
<p>In this scenario, the following commands can be used:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../sql/create-function.html"><span class="doc std std-doc">CREATE FUNCTION</span></a> to create and store a routine.</p></li>
<li><p><a class="reference internal" href="../sql/drop-function.html"><span class="doc std std-doc">DROP FUNCTION</span></a> to remove a routine.</p></li>
<li><p><a class="reference internal" href="../sql/show-functions.html"><span class="doc std std-doc">SHOW FUNCTIONS</span></a> to display a list of routines in a catalog.</p></li>
</ul>
<p>Catalog routines must use a name that combines the catalog name and schema name
with the routine name, such as <code class="docutils literal notranslate"><span class="pre">example.default.power</span></code> for the <code class="docutils literal notranslate"><span class="pre">power</span></code> routine
in the <code class="docutils literal notranslate"><span class="pre">default</span></code> schema of the <code class="docutils literal notranslate"><span class="pre">example</span></code> catalog.</p>
<p>Invocation must use the fully qualified name, such as <code class="docutils literal notranslate"><span class="pre">example.default.power</span></code>.</p>
</section>
<section id="sql-environment-configuration">
<span id="routine-sql-environment"></span><h2 id="sql-environment-configuration">SQL environment configuration<a class="headerlink" href="#sql-environment-configuration" title="Link to this heading">#</a></h2>
<p>Configuration of the <code class="docutils literal notranslate"><span class="pre">sql.default-function-catalog</span></code> and
<code class="docutils literal notranslate"><span class="pre">sql.default-function-schema</span></code> <a class="reference internal" href="../admin/properties-sql-environment.html"><span class="doc std std-doc">SQL environment properties</span></a> allows you
to set the default storage for SQL routines. The catalog and schema must be
added to the <code class="docutils literal notranslate"><span class="pre">sql.path</span></code> as well. This enables users to call SQL routines and
perform all <a class="reference internal" href="../language/sql-support.html#sql-routine-management"><span class="std std-ref">SQL routine management</span></a> without specifying
the full path to the routine.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use the <a class="reference internal" href="../connector/memory.html"><span class="doc std std-doc">Memory connector</span></a> in a catalog for simple storing and
testing of your SQL routines.</p>
</div>
</section>
<section id="routine-declaration">
<span id="id1"></span><h2 id="routine-declaration">Routine declaration<a class="headerlink" href="#routine-declaration" title="Link to this heading">#</a></h2>
<p>Refer to the documentation for the <a class="reference internal" href="function.html"><span class="doc std std-doc">FUNCTION</span></a> keyword for more
details about declaring the routine overall. The routine body is composed with
statements from the following list:</p>
<ul class="simple">
<li><p><a class="reference internal" href="begin.html"><span class="doc std std-doc">BEGIN</span></a></p></li>
<li><p><a class="reference internal" href="case.html"><span class="doc std std-doc">CASE</span></a></p></li>
<li><p><a class="reference internal" href="declare.html"><span class="doc std std-doc">DECLARE</span></a></p></li>
<li><p><a class="reference internal" href="if.html"><span class="doc std std-doc">IF</span></a></p></li>
<li><p><a class="reference internal" href="iterate.html"><span class="doc std std-doc">ITERATE</span></a></p></li>
<li><p><a class="reference internal" href="leave.html"><span class="doc std std-doc">LEAVE</span></a></p></li>
<li><p><a class="reference internal" href="loop.html"><span class="doc std std-doc">LOOP</span></a></p></li>
<li><p><a class="reference internal" href="repeat.html"><span class="doc std std-doc">REPEAT</span></a></p></li>
<li><p><a class="reference internal" href="return.html"><span class="doc std std-doc">RETURN</span></a></p></li>
<li><p><a class="reference internal" href="set.html"><span class="doc std std-doc">SET</span></a></p></li>
<li><p><a class="reference internal" href="while.html"><span class="doc std std-doc">WHILE</span></a></p></li>
</ul>
<p>Statements can also use <a class="reference internal" href="../functions.html"><span class="doc std std-doc">built-in functions and operators</span></a> as well
as other routines, although recursion is not supported for routines.</p>
<p>Find simple examples in each statement documentation, and refer to the <a class="reference internal" href="examples.html"><span class="doc std std-doc">example
documentation</span></a> for more complex use cases that combine
multiple statements.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>User-defined functions can alternatively be written in Java and deployed as a
plugin. Details are available in the <a class="reference internal" href="../develop/functions.html"><span class="doc std std-doc">developer guide</span></a>.</p>
</div>
</section>
<section id="labels">
<span id="routine-label"></span><h2 id="labels">Labels<a class="headerlink" href="#labels" title="Link to this heading">#</a></h2>
<p>Routines can contain labels as markers for a specific block in the declaration
before the following keywords:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CASE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IF</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LOOP</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REPEAT</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WHILE</span></code></p></li>
</ul>
<p>The label is used to name the block to continue processing with the <code class="docutils literal notranslate"><span class="pre">ITERATE</span></code>
statement or exit the block with the <code class="docutils literal notranslate"><span class="pre">LEAVE</span></code> statement. This flow control is
supported for nested blocks, allowing to continue or exit an outer block, not
just the innermost block. For example, the following snippet uses the label
<code class="docutils literal notranslate"><span class="pre">top</span></code> to name the complete block from <code class="docutils literal notranslate"><span class="pre">REPEAT</span></code> to <code class="docutils literal notranslate"><span class="pre">END</span> <span class="pre">REPEAT</span></code>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">top</span><span class="p">:</span><span class="w"> </span><span class="n">REPEAT</span>
<span class="w">  </span><span class="k">SET</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">IF</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">THEN</span>
<span class="w">    </span><span class="k">ITERATE</span><span class="w"> </span><span class="n">top</span><span class="p">;</span>
<span class="w">  </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="p">;</span>
<span class="w">  </span><span class="k">SET</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="k">UNTIL</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">10</span>
<span class="k">END</span><span class="w"> </span><span class="n">REPEAT</span><span class="p">;</span>
</pre></div>
</div>
<p>Labels can be used with the <code class="docutils literal notranslate"><span class="pre">ITERATE</span></code> and <code class="docutils literal notranslate"><span class="pre">LEAVE</span></code> statements to continue
processing the block or leave the block. This flow control is also supported for
nested blocks and labels.</p>
</section>
<section id="recommendations">
<h2 id="recommendations">Recommendations<a class="headerlink" href="#recommendations" title="Link to this heading">#</a></h2>
<p>Processing routines can potentially be resource intensive on the cluster in
terms of memory and processing. Take the following considerations into account
when writing and running SQL routines:</p>
<ul class="simple">
<li><p>Some checks for the runtime behavior of routines are in place. For example,
routines that take longer to process than a hardcoded threshold are
automatically terminated.</p></li>
<li><p>Avoid creation of arrays in a looping construct. Each iteration creates a
separate new array with all items and copies the data for each modification,
leaving the prior array in memory for automated clean up later. Use a <a class="reference internal" href="../functions/lambda.html"><span class="doc std std-doc">lambda
expression</span></a> instead of the loop.</p></li>
<li><p>Avoid concatenating strings in a looping construct. Each iteration creates a
separate new string and copying the old string for each modification, leaving
the prior string in memory for automated clean up later. Use a <a class="reference internal" href="../functions/lambda.html"><span class="doc std std-doc">lambda
expression</span></a> instead of the loop.</p></li>
<li><p>Most routines should declare the <code class="docutils literal notranslate"><span class="pre">RETURNS</span> <span class="pre">NULL</span> <span class="pre">ON</span> <span class="pre">NULL</span> <span class="pre">INPUT</span></code> characteristics
unless the code has some special handling for null values. You must declare
this explicitly since <code class="docutils literal notranslate"><span class="pre">CALLED</span> <span class="pre">ON</span> <span class="pre">NULL</span> <span class="pre">INPUT</span></code> is the default characteristic.</p></li>
</ul>
</section>
<section id="limitations">
<h2 id="limitations">Limitations<a class="headerlink" href="#limitations" title="Link to this heading">#</a></h2>
<p>The following limitations apply to SQL routines.</p>
<ul class="simple">
<li><p>Routines must be declared before they are referenced.</p></li>
<li><p>Recursion cannot be declared or processed.</p></li>
<li><p>Mutual recursion can not be declared or processed.</p></li>
<li><p>Queries cannot be processed in a routine.</p></li>
</ul>
<p>Specifically this means that routines can not use <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> queries to retrieve
data or any other queries to process data within the routine. Instead queries
can use routines to process data. Routines only work on data provided as input
values and only provide output data from the <code class="docutils literal notranslate"><span class="pre">RETURN</span></code> statement.</p>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../routines.html" title="SQL routines"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> SQL routines </span>
              </div>
            </a>
          
          
            <a href="examples.html" title="Example SQL routines"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Example SQL routines </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>